doctype html
html(lang="en")
    head
        meta(charset="UTF-8")
        meta(name="viewport" content="width=device-width, initial-scale=1.0")
        title= title || 'BUG Radio'

        //- Fonts
        link(rel="preconnect" href="https://fonts.googleapis.com")
        link(rel="preconnect" href="https://fonts.gstatic.com" crossorigin)
        link(href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet")

        //- CSS
        link(rel="stylesheet" href="/public/css/style.css")

        //- Alpine.js
        script(defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js")

    body
        header.site-header
            .container
                .header-top
                    img.logo(src="/public/assets/logo.jpeg")

                    nav.main-nav
                        a(href="/" class=currentPath === '/' ? 'active' : '') HOME
                        a(href="/about") ABOUT
                        a(href="/gallery") GALLERY
                        a(href="/shows") SHOWS
                        a(href="/schedule") SCHEDULE
                        a(href="/open-call") OPEN CALL
                        a(href="/education") EDUCATION
                        a(href="/partners") PARTNERS

            //- Player

            .container
                .player(x-data="{ playing: false, volume: 80 }")
                    #visualizer.audio-visualizer

                    .player-status
                        .live-indicator#live-indicator
                            span.live-dot
                            span#live-text OFFLINE
                        .track-info BUG Radio

                    .player-controls
                        audio#player-audio(x-ref="audio" src="https://bugradio2024.out.airtime.pro/bugradio2024_a" preload="none" crossorigin="anonymous")
                        button.btn-play(@click="playing ? $refs.audio.pause() : $refs.audio.play(); playing = !playing")
                            span(x-show="!playing") ▶
                            span(x-show="playing") ⏸

        //- Audio Visualizer
        script(src="/public/js/audio-visualizer.js")

        script.
            (function() {
                const indicator = document.getElementById('live-indicator');
                const text = document.getElementById('live-text');
                const audioSrc = 'https://bugradio2024.out.airtime.pro/bugradio2024_a';

                function checkStream() {
                    const audio = new Audio(audioSrc);
                    audio.volume = 0;

                    audio.play()
                        .then(() => {
                            audio.pause();
                            indicator.classList.remove('offline');
                            indicator.classList.add('on-air');
                            text.textContent = 'ON AIR';
                        })
                        .catch(() => {
                            indicator.classList.remove('on-air');
                            indicator.classList.add('offline');
                            text.textContent = 'OFFLINE';
                        });
                }

                checkStream();
                setInterval(checkStream, 30000);
            })();

        main
            block content

        footer.site-footer
            .footer-top
                .footer-section
                    h3 JOIN OUR COMMUNITY
                    a(href="/open-call") SUBMIT YOUR SHOW
                .footer-section
                    h3 BUG RADIO IS SUPPORTED BY...
                    a(href="/partners") PARTNERS

            .footer-bottom
                p © #{new Date().getFullYear()} BUG Radio
